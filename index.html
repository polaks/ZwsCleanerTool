<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–û—á–∏—Å—Ç–∫–∞ —Å–∫—Ä—ã—Ç—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 900px;
      margin: auto;
      background-color: #f9f9f9;
    }
    .wrapper {
      position: relative;
    }
    .highlighter {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 150px;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background-color: #fffbe6;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow: hidden;
      pointer-events: none;
      color: transparent;
    }
    .highlight {
      background-color: yellow;
      color: black;
      position: relative;
      cursor: help;
    }
    .highlight::after {
      content: attr(data-title);
      position: absolute;
      bottom: 120%;
      left: 0;
      background: #333;
      color: #fff;
      padding: 4px 8px;
      border-radius: 4px;
      white-space: nowrap;
      font-size: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      z-index: 10;
    }
    .highlight:hover::after {
      opacity: 1;
    }
    textarea {
      width: 100%;
      height: 150px;
      font-family: monospace;
      padding: 10px;
      font-size: 14px;
      background-color: transparent;
      border: 1px solid #ccc;
      border-radius: 6px;
      position: relative;
      z-index: 1;
      color: black;
    }
    button {
      padding: 10px 20px;
      margin-bottom: 10px;
      margin-right: 10px;
      cursor: pointer;
    }
    .counter {
      margin-bottom: 10px;
      font-size: 14px;
      color: #555;
    }
    #output {
      width: 100%;
      height: 100px;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h2>üßπ –£–¥–∞–ª–µ–Ω–∏–µ —Å–∫—Ä—ã—Ç—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ + –∑–∞–º–µ–Ω—ã</h2>
  <p>–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ç–µ–∫—Å—Ç ‚Äî –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –ø–æ–¥—Å–≤–µ—Ç—è—Ç—Å—è —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏, –∑–∞–º–µ–Ω—ã –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è üëá</p>

  <div class="wrapper">
    <div id="highlighter" class="highlighter"></div>
    <textarea id="input" oninput="handleInput()" spellcheck="false"></textarea>
  </div>

  <div class="counter" id="counter"></div>
  <button onclick="copyOutput()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—á–∏—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç</button>
  <button onclick="clearInput()">üóë –û—á–∏—Å—Ç–∏—Ç—å</button>
  <p>–û—á–∏—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:</p>
  <textarea id="output" readonly></textarea>

  <script>
    // –¢–∞–±–ª–∏—Ü–∞ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–∫—Ä—ã—Ç—ã—Ö/—É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
    const invisibleChars = {
      '\u200B': 'Zero Width Space (U+200B)',
      '\u200C': 'Zero Width Non-Joiner (U+200C)',
      '\u200D': 'Zero Width Joiner (U+200D)',
      '\u200E': 'Left-To-Right Mark (U+200E)',
      '\u200F': 'Right-To-Left Mark (U+200F)',
      '\uFEFF': 'Zero Width No-Break Space (U+FEFF)',
      '\u2060': 'Word Joiner (U+2060)',
      '\u00A0': 'Non-breaking Space (U+00A0)',
      '\u2014': 'Em Dash (U+2014)'
    };

    // –î–æ–±–∞–≤–∏–º —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏–º–≤–æ–ª—ã ASCII 0x00‚Äì0x1F –∏ 0x7F
    for (let i = 0; i <= 31; i++) {
      invisibleChars[String.fromCharCode(i)] = `Control char U+${i.toString(16).padStart(4, '0')}`;
    }
    invisibleChars[String.fromCharCode(127)] = 'Delete (U+007F)';

    function handleInput() {
      const input = document.getElementById('input').value;
      const cleaned = cleanText(input);
      document.getElementById('output').value = cleaned;
      updateCounter(input);
      updateHighlight(input);
    }

    function cleanText(text) {
      return text
        .replace(/\u00A0/g, ' ')      // –Ω–µ—Ä–∞–∑—Ä—ã–≤–Ω—ã–π –ø—Ä–æ–±–µ–ª ‚Üí –æ–±—ã—á–Ω—ã–π
        .replace(/\u2014/g, '-')      // –¥–ª–∏–Ω–Ω–æ–µ —Ç–∏—Ä–µ ‚Üí –∫–æ—Ä–æ—Ç–∫–æ–µ
        .replace(/[\u200B-\u200F\uFEFF\u2060]/g, '') // —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–≤–∏–¥–∏–º—ã—Ö
        .replace(/[\x00-\x1F\x7F]/g, ''); // —É–¥–∞–ª–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö
    }

    function updateCounter(text) {
      const total = text.length;
      const hidden = [...text].filter(c => c in invisibleChars).length;
      document.getElementById('counter').textContent = `–°–∏–º–≤–æ–ª–æ–≤ –≤—Å–µ–≥–æ: ${total} | –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö: ${hidden}`;
    }

    function updateHighlight(text) {
      const highlighted = [...text].map(char => {
        if (invisibleChars[char]) {
          const title = invisibleChars[char];
          const code = char.charCodeAt(0).toString(16).toUpperCase().padStart(4, '0');
          return `<span class="highlight" data-title="${title}">[${code}]</span>`;
        }
        return char
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;');
      }).join('');
      document.getElementById('highlighter').innerHTML = highlighted;
    }

    function copyOutput() {
      const output = document.getElementById('output');
      output.select();
      document.execCommand('copy');
      alert('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
    }

    function clearInput() {
      document.getElementById('input').value = '';
      document.getElementById('output').value = '';
      document.getElementById('counter').textContent = '';
      document.getElementById('highlighter').innerHTML = '';
    }
  </script>
</body>
</html>
